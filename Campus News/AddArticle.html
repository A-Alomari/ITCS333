<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UniHub</title>
  <link rel="icon" href="../images/Logo.png">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/froala-editor@latest/css/froala_editor.pkgd.min.css" rel="stylesheet" />
  <link href="Style.css" rel="stylesheet" />
</head>
<body>
<!-- Header -->
<header class="p-3 navbar navbar-expand-md navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="../index.html">
            <img src="Pic\Logo.png" alt="Logo" width="30" height="24">
        </a>
        <button class="navbar-toggler ms-auto" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <div class="navbar-nav mr-auto">
                <a class="nav-link" href="../index.html">Home</a>
                <a class="nav-link active" href="../Campus News/Campus News.html">Campus News</a>
                <a class="nav-link" href="../course-review2/Course-Review.html">Course Review</a>
                <a class="nav-link" href="../Events Calendar/Events-Calender.html">Events Calendar</a>
                <a class="nav-link" href="../Phase1_Course-Notes/Course-Notes.html">Course Notes</a>
                <a class="nav-link" href="../Phase1-ClubActivity/ClubActivity.html">Club Activities</a>
                <a class="nav-link" href="../student-Marketplace/StudentMarketplace.html">Student Marketplace</a>
            </div>
        </div>
    </div>
  </header>
  
<!--Main-->
<main class="container mt-4">
  <!-- Back, Edit, and Delete Buttons -->
  <div class="mb-3 d-flex justify-content-between">
      <a href="Campus News.html" class="btn" style="background-color: #4DA1A9; color: white;">Back</a>
      <div>
          <button class="btn btn-danger">Delete</button>
      </div>
  </div>

  <h2 class="mb-4">Add Article</h2>
  <form action="submit_article.php" method="POST">
    <div id="form-errors" class="text-danger mb-3"></div>
    <div class="mb-3">
      <label class="form-label">Title <span class="text-danger">*</span></label>
      <input type="text" class="form-control" name="title" required>
    </div>

    <div class="mb-3">
      <label class="form-label">College <span class="text-danger">*</span></label>
      <select class="form-select" name="college" required>
        <option value="" disabled selected>Select a college</option>
        <option value="all">All Colleges</option>
        <option value="College of Law">College of Law</option>
        <option value="College of Arts">College of Arts</option>
        <option value="College of Science">College of Science</option>
        <option value="College of Engineering">College of Engineering</option>
        <option value="Bahrain Teachers College">Bahrain Teachers College</option>
        <option value="College of Applied Science">College of Applied Science</option>
        <option value="College of Information Technology">College of Information Technology</option>
        <option value="College of Business Administration">College of Business Administration</option>
        <option value="College of Health and Sport Sciences">College of Health and Sport Sciences</option>
      </select>
    </div>

    <div class="mb-3">
      <label class="form-label">Course Code (optional)</label>
      <input type="text" class="form-control" name="course_code" placeholder="e.g., CS101">
    </div>

    <div class="mb-3">
      <label class="form-label">Article Image</label>
      <div class="input-group">
        <input type="file" class="form-control" name="image_file" accept="image/*">
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label">Content</label>
      <div id="froala-editor"></div>
      <textarea name="content" style="display:none;"></textarea> <!-- Froala Editor will populate this -->
    </div>

    <button type="submit" class="btn btn-outline-primary">Publish</button>
  </form>
</main>

<!-- Footer -->
<footer class="text-center py-3 mt-5">
  &copy; 2025 UNIHUB. All rights reserved.
</footer>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/froala-editor@latest/js/froala_editor.pkgd.min.js"></script>
<script>
  new FroalaEditor("#froala-editor", {
    events: {
      'froalaEditor.contentChanged': function () {
        var editorContent = this.html.get(); // Get the HTML content
        document.querySelector('textarea[name="content"]').value = editorContent;
      }
    }
  });

  document.addEventListener('DOMContentLoaded', () => {
    // Check if there is a selected article in localStorage
    const selectedArticle = JSON.parse(localStorage.getItem('selectedArticle'));

    if (selectedArticle) {
        // Populate the form fields with the selected article details
        const titleInput = document.querySelector('input[name="title"]');
        const contentTextarea = document.querySelector('textarea[name="content"]');
        const imageInput = document.querySelector('input[name="image_file"]');
        const collegeSelect = document.querySelector('select[name="college"]');
        const courseCodeInput = document.querySelector('input[name="course_code"]');
        const publishButton = document.querySelector('button[type="submit"]');

        if (titleInput) titleInput.value = selectedArticle.title;
        if (contentTextarea) contentTextarea.value = selectedArticle.content;
        if (imageInput) imageInput.value = selectedArticle.image;
        if (collegeSelect) collegeSelect.value = selectedArticle.college;
        if (courseCodeInput) courseCodeInput.value = selectedArticle.courseCode;

        // Change the publish button to an update button
        if (publishButton) {
            publishButton.textContent = 'Update';
            publishButton.addEventListener('click', (e) => {
                e.preventDefault();

                // Update the article details
                const updatedArticle = {
                    title: titleInput.value,
                    content: contentTextarea.value,
                    image: imageInput.value,
                    college: collegeSelect.value,
                    courseCode: courseCodeInput.value
                };

                // Save the updated article back to localStorage (or send to server if needed)
                localStorage.setItem('selectedArticle', JSON.stringify(updatedArticle));

                alert('Article updated successfully!');

                // Redirect back to the Campus News page
                window.location.href = 'Campus News.html';
            });
        }
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.querySelector('form');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const title = form.querySelector('input[name="title"]').value;
      const college = form.querySelector('select[name="college"]').value;
      const courseCode = form.querySelector('input[name="course_code"]').value || null;
      const image = form.querySelector('input[name="image_file"]').files[0]?.name || "default.jpg";
      const content = form.querySelector('textarea[name="content"]').value;

      if (!title || !college) {
        alert('Title and College are required fields.');
        return;
      }

      const newArticle = {
        id: Date.now(), // Use a timestamp as a unique ID
        title,
        content,
        author: "Anonymous", // Default author
        date: new Date().toISOString().split('T')[0], // Current date in YYYY-MM-DD format
        image: `Pic/${image}`,
        college,
        courseCode,
        views: 0
      };

      try {
        const response = await fetch('https://replit.com/@A-Alomari/camp#add_article.php', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify(newArticle)
});

        if (response.ok) {
          alert('Article added successfully!');
          window.location.href = 'Campus News.html';
        } else {
          alert('Failed to add article. Please try again.');
        }
      } catch (error) {
        console.error('Error adding article:', error);
        alert('An error occurred. Please try again later.');
      }
    });
  });
</script>
</body>
</html>